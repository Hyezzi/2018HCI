<!DOCTYPE html>
<html style = "width : 100% ; height : 100%;">
<head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>HCI Assignment</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" media="screen" href="../style.css" />
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
         <!--font-->
        <!--fontawesome-->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
        <!--Bootstrap-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <!--Bootstrap-->
</head>
<body>
    <!--Navbar-->
    <nav class="navbar">
        <!-- Navbar brand -->
        <a class="navbar-brand" href="../index.html">Human Computer Interaction
            <span style = "font-size : 0.6em;">영어영문학과 2015130741 원혜진</span>
        </a>
    
        <!-- Collapse button -->
        <button class="navbar-toggler toggler-example" type="button" data-toggle="collapse" data-target="#navbarSupportedContent1"
        aria-controls="navbarSupportedContent1" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fa fa-bars fa-1x"></i></span>
        </button>

        <!-- Collapsible content -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent1">
            <!-- Links -->
            <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a href="../index.html"><span class = "nav-link">180918_Assignment 1</span></a>
            </li>
            <li class="nav-item">
                <a href="../assignment2.html"><span class = "nav-link">180920_Assignment 2</span></a>
            </li>
            <li class="nav-item">
                <a href="../assignment3.html"><span class = "nav-link">181022_Assignment 3</span></a>
            </li>
            <li class="nav-item">
                <a href = "../resume/resume.html" target="_blank" rel="noopener noreferrer"><span class = "nav-link">181102_Resume</span></a>
            </li>
            <li class="nav-item">
                <a href="./4-1-1.html"><span class = "nav-link">181113_Assignment 4-1-1</span></a>
            </li>
            <li class="nav-item">
                <a href="./4-2-1.html"><span class = "nav-link">181116_Assignment 4-2-1</span></a>
            </li>
            <li class="nav-item">
                <a href="./4-1-2.html"><span class = "nav-link">181120_Assignment 4-1-2</span></a>
            </li>
            <li class="nav-item">
                <a href="./4-2-2.html"><span class = "nav-link">181116_Assignment 4-2-2</span></a>
            </li>
            <li class="nav-item">
                <a href="./4-1-3.html"><span class = "nav-link">181204_Assignment 4-1-3</span></a>
            </li>    
        </ul>
            <!-- Links -->
        
        </div>
        <!-- Collapsible content -->
    </nav>
    <!--/.Navbar-->
    <div class = "container-fluid" style = "width: 100%">
        <div class = "row">       
            <div class = "col-xl-12 col-lg-12 px-0">
                <div class = "py-5 background title-section d-flex flex-column align-items-center justify-content-center">
                    <h1 class = "mb-5">Human Computer Interaction</h1>
                    <h5>181120_Assignment4-1-3</h5>
                    <h5>Mouse Input Routine</h5>
                </div>
            </div>
            <div class = "row">
                <div class = "col-xl-10 col-lg-10 mx-auto mt-3">
                    <canvas id="myCanvas" width = 1050 height = 1000 onclick = "getMousePosition(event)"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <footer class = "bg-dark">
        <p class = "text-center text-white pt-5 mt-5 mb-1">Human Computer Interaction</p>
        <p class = "text-center text-white mb-1">인간컴퓨터상호작용</p>
        <p class = "text-center text-white pb-5" style = "margin: 0px;">2018-2R</p>
    </footer> 
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        var canvasID = "myCanvas";    
        var id = 0;

        var max_node_width = 230;
        var max_node_height = 180;
        var lineLength = 50;

        var tree = new _Tree("window");
        tree.add_node("button", 0, tree.search_BF, 100, 120);
        tree.add_node("textbox", 0, tree.search_BF, 300, 400);
        tree.add_node("textbox", 1, tree.search_BF, 200, 300);
        tree.add_node("button", 2, tree.search_BF, 100, 410);
        tree.add_node("window", 3, tree.search_BF, 300, 20);

        //draw tree
        traverse4draw(tree);


       
        /*Queue*/
        function _Queue() {
            this.q = []
            this.enqueue = function enqueue(element) {
                this.q.push(element)
            }
            
            this.dequeue = function dequeue() {
                return this.q.shift()
            }
        
            this.front = function front() {
                return this.q[0]
            }
            this.back = function back() {
                return this.q[this.q.length - 1]
            }
        }
        
        
        function _Node(graphicElement){
            this.id = id;
            this.graphicElement = graphicElement;
            this.parent = null;
            this.position_x = 0;
            this.position_y = 0;
            this.children = [];

            switch (graphicElement){
                case "window" :
                    this.width = max_node_width;
                    this.height = max_node_height;
                    break;
                case "button" : 
                    this.width = max_node_width;
                    this.height = 100;
                    break;
                case "textbox" : 
                    this.width = max_node_width;
                    this.height = 30;
                    break;
                case "pulldown" : 
                    this.width = max_node_width;
                    this.height = 50;
                    break;
        }


        }
        
        function _Tree(graphicElement) {
            var node = new _Node(graphicElement);
            this._root = node;

            id += 1;

            
            this.search_BF = function(callback) {

                var queue = new _Queue();
                
                queue.enqueue(this._root);
            
                currentTree = queue.dequeue();
            
                while(currentTree){
                    for (var i = 0, length = currentTree.children.length; i < length; i++) {
                        queue.enqueue(currentTree.children[i]);
                    }

                    callback(currentTree);

                    currentTree = queue.dequeue();
                }
            };
            
            this.search_DF = function(callback) {    
                (function recurse(currentNode) {
                    for (var i = 0, length = currentNode.children.length; i < length; i++) {
                        recurse(currentNode.children[i]);
                    }
                    callback(currentNode);
                })(this._root);
            };
            
            this.contains = function(callback, traversal) {
                traversal.call(this, callback);
            };

            this.add_node = function(graphicElement, parentID, traversal, x, y) {
                var child = new _Node(graphicElement),
                    parent = null,
                    callback = function(node) {
                        if (node.id === parentID) {
                            parent = node;
                        } 
                    };
            
                this.contains(callback, traversal);
            
                if (parent) {
                    parent.children.push(child);
                    child.parent = parent;
                    child.position_x = x;
                    child.position_y = y;
                    id += 1;
                } else {
                    throw new Error('Cannot add node to a non-existent parent.');
                }
            };

            this.delete_node = function(childID, parentID, traversal) {
                var tree = this,
                    parent = null,
                    childToRemove = null,
                    index;
            
                var callback = function(node) {
                    if (node.id === parentID) {
                        parent = node;
                    }
                };
            
                this.contains(callback, traversal);
            
                if (parent) {
                    index = findIndex(parent.children, childID);
            
                    if (index === undefined) {
                        throw new Error('Node to remove does not exist.');
                    } else {
                        childToRemove = parent.children.splice(index, 1);
                    }
                } else {
                    throw new Error('Parent does not exist.');
                }
            
                return childToRemove;
            };
        }

        function findIndex(arr, targetID) {
            var index;
        
            for (var i = 0; i < arr.length; i++) {
                if (arr[i].id === targetID) {
                    index = i;
                }
            }
        
            return index;
        }


        function traverse4draw(tree) {
            console.log("starting traverse for draw...");

            //use bfs to set x, y of elements
            var queue = new _Queue();

            queue.enqueue(tree._root);
            currentTree = queue.dequeue();

            //draw root first
            drawGUI(currentTree);                    
            

            while(currentTree){
                for (var i = 0, length = currentTree.children.length; i < length; i++) {
                    queue.enqueue(currentTree.children[i]);

                    // //draw each children
                    // if(i != 0)
                    //     currentTree.children[i].position_x = currentTree.children[i-1].position_x + max_node_width + 20;
                    // else
                    //     currentTree.children[i].position_x = currentTree.position_x;
                    
                    // currentTree.children[i].position_y = currentTree.position_y + max_node_height + lineLength;

                    drawGUI(currentTree.children[i]);                    
                }

                currentTree = queue.dequeue();
            }
        };

        function drawGUI(node){
    
            switch (node.graphicElement){
                case "window" :
                    create_window (canvasID, `ID : ${node.id}\n Type : ${node.graphicElement}`, node.position_x, node.position_y, max_node_width, max_node_height);
                    break;
                case "button" : 
                    create_button(canvasID, `ID : ${node.id}\n Type : ${node.graphicElement}`, node.position_x, node.position_y, max_node_width, 100);
                    break;
                case "textbox" : 
                    create_textbox(canvasID,  `ID : ${node.id}\n Type : ${node.graphicElement}`, node.position_x, node.position_y, max_node_width, 30);
                    break;
                case "pulldown" : 
                    create_pulldown(canvasID, `ID : ${node.id}\n Type : ${node.graphicElement}`, node.position_x, node.position_y, max_node_width, 50);
                    break;
            }

        }

        //function for making window, close, hide button
        function create_window (ID, window_title, position_x, position_y, width, height){
            var canvas = document.getElementById(ID);
            var context = canvas.getContext('2d');
            
            //draw window background
            context.fillStyle = 'rgb(247,235,213)'; 
            context.fillRect(position_x, position_y, width, height);   

            //draw window bar
            context.fillStyle = 'rgb(34,28,56)'; 
            context.fillRect(position_x, position_y, width, height/7); 

            //window_title text
            context.fillStyle = 'rgb(255,255,255)';
            context.font = '15px sans-serif';
            context.fillText(window_title, position_x + 20, position_y + 18, position_x + width - height / 7 * 2);
            
            //hide button
            var hide_start = position_x + width - height / 7 * 2;
            context.fillStyle = 'rgb(242,210,163)'; 
            context.fillRect(hide_start, position_y, height/7, height/7); 
            //close button
            var close_start = position_x + width - height / 7;
            context.fillStyle = 'rgb(80,56,54)'; 
            context.fillRect(close_start, position_y, height/7, height/7); 

        
            //draw _
            context.beginPath();
            context.moveTo(hide_start + 4, position_y + height/7 - 8);
            context.lineTo(close_start - 4, position_y + height/7 - 8);
            context.stroke();
            context.closePath();

            //draw X
            context.beginPath();
            // \
            context.moveTo(close_start + 3, position_y + 3);
            context.lineTo(position_x + width - 3, position_y + height/7 - 3);
            // /
            context.moveTo(position_x + width - 3, position_y + 3);
            context.lineTo(close_start + 3, position_y + height/7 - 3);
            context.stroke();
            context.closePath();
        }
           
        function create_button (ID, button_title, position_x, position_y, width, height){
            var canvas = document.getElementById(ID);
            var context = canvas.getContext('2d');
            
            //draw window background
            context.fillStyle = 'rgb(242,210,163)'; 
            context.fillRect(position_x, position_y, width, height);   

            //window_title text
            context.fillStyle = 'rgb(0,0,0)';
            context.font = '15px sans-serif';
            
            context.fillText(button_title, position_x + 20, position_y + 25, position_x + width);

        }

        function create_textbox (ID, textbox_title, position_x, position_y, width, height){
            var canvas = document.getElementById(ID);
            var context = canvas.getContext('2d');
            
            //draw textbox background
            context.fillStyle = 'rgb(80,56,54)'; 
            context.fillRect(position_x, position_y, width, height);   

            //textbox_title text
            context.fillStyle = 'rgb(255,255,255)';
            context.font = '15px sans-serif';
            
            context.fillText(textbox_title, position_x + 20, position_y + 20, position_x + width);

        }


        function create_pulldown(ID, pulldown_title, position_x, position_y, width, height){
            var canvas = document.getElementById(ID);
            var context = canvas.getContext('2d');
            
            //draw window background
            context.fillStyle = 'rgb(34,28,56)'; 
            context.fillRect(position_x, position_y, width, height);   

            //window_title text
            context.fillStyle = 'rgb(255,255,255)';
            context.font = '15px sans-serif';
            
            context.fillText(pulldown_title, position_x + 30, position_y + 35, position_x + width);
            
            var submenu_x = position_x + 10;
            var submenu_y = position_y + height -10;
            
            add_submenu(ID, "submenu 1", submenu_x, submenu_y, width, height);
            submenu_y+= height;
            add_submenu(ID, "submenu 2", submenu_x, submenu_y, width, height);
            submenu_y+= height;
            add_submenu(ID, "submenu 3", submenu_x, submenu_y, width, height);
    
        }
        
        function add_submenu(ID, submenu_title, position_x, position_y, width, height){
            var canvas = document.getElementById(ID);
            var context = canvas.getContext('2d');
            
            //draw window background
            context.fillStyle = 'rgb(34,28,56, 0.8)'; 
            context.fillRect(position_x, position_y, width, height);   

            //window_title text
            context.fillStyle = 'rgb(255,255,255)';
            context.font = '15px sans-serif';
            
            context.fillText(submenu_title, position_x + 30, position_y + 35, position_x + width);
            
        }

        //get mouse position
        function getMousePosition(e){
            //console.log(e)

            var canvasOffset = $("#myCanvas")[0].getBoundingClientRect();
            var canvasX=canvasOffset.left;
            var canvasY=canvasOffset.top;
            // console.log("캔버스x좌표 : "+ canvasX);
            // console.log("캔버스y좌표 : " + canvasY);

            mouseX=parseInt(e.clientX-canvasX);
            mouseY=parseInt(e.clientY-canvasY);
            // console.log("마우스x좌표 : " + mouseX);
            // console.log("마우스y좌표 : " + mouseY);

            //find upper node
            var topNode = findUpperNode(mouseX, mouseY);

            alert("마우스 x좌표 : " + mouseX + "\n마우스 y좌표 : " + mouseY +"\n\n"+ "ID : " + topNode.id + "\n"+ "ELEMENT TYPE : " + topNode.graphicElement + "\n"+"클릭했습니다 :)");
        }
        

        function findUpperNode(mouseX, mouseY){
            //get mouse click position and calculate the most upper one.
            console.log("finding upper node...");

            //1. get node that is under clicked position   
            var searchQue = new _Queue();

            searchQue.enqueue(tree._root);
            currentTree = searchQue.dequeue();

            var checkList = [];
            
            while(currentTree){
                //console.log("current Tree : " + currentTree.id);
                //console.log(checkPosition(mouseX, mouseY, currentTree));
                if (checkPosition(mouseX, mouseY, currentTree)){
                        checkList.push(currentTree);
                        console.log(currentTree.id + "matches criteria")
                }         

                for (var i = 0, length = currentTree.children.length; i < length; i++) {
                    searchQue.enqueue(currentTree.children[i]);
                }

                currentTree = searchQue.dequeue();
            }



            //2. find the most upper node
            var topID = 0;
            var topNode;

            checkList.forEach((node)=>{
                if(topID <= node.id){
                    topID = node.id;
                    topNode = node;
                }
            })
            
            return topNode;
        }

        function checkPosition(mouseX, mouseY, node){
            var nodeX = node.position_x;
            var nodeY = node.position_y;

            if ((nodeX <= mouseX) && (mouseX <= (nodeX + node.width))){
                if ((nodeY <= mouseY) && (mouseY <= (nodeY + node.height))){
                    //console.log("true");
                    return true;
                }
            }
            else
                return false;
        }

    </script>
</body>
</html>